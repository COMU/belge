<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-9"><meta name="date" content="2008-10-29T16:53:33+02:00"><title>Þifrelenmiþ Ev Dizini Oluþturulmasý ve Kullanýmý</title><link rel="icon" type="image/png" href="../images/belgeler-logo.png"><link rel="stylesheet" href="../belgeler.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V-special(derived from 1.49 for Turkish Linux Documentation WG by Nilgün Belma Bugüner - nilgun@superonline.com)"><link rel="home" href="../KiTAPLIK/index.html" title="Linux Kitaplýðý"><link rel="up" href="../howto/encrypted-swap-howto.html" title="Þifrelenmiþ Takas Alaný ve Ev Dizini NASIL"><link rel="previous" href="../howto/encrypted-swap-howto-part1.html" title="Þifrelenmiþ Takas Alaný Kurulumu"><link rel="next" href="../howto/encrypted-swap-howto-part3.html" title="Oturum Açýlýrken Otomatik Baðlama"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><th colspan="3" align="center">Þifrelenmiþ Ev Dizini Oluþturulmasý ve Kullanýmý</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../howto/encrypted-swap-howto-part1.html">Önceki</a> </td><th width="60%" align="center">Þifrelenmiþ Takas Alaný ve Ev Dizini NASIL</th><td width="20%" align="right"> <a accesskey="n" href="../howto/encrypted-swap-howto-part3.html">Sonraki</a></td></tr></table></td></tr></table></td></tr></table><dl><div class="sect1"><dt><div> <h2 class="title" style="clear: both"><a name="encrypted-swap-howto-part2"></a>Þifrelenmiþ Ev Dizini Oluþturulmasý ve Kullanýmý</h2></div></dt><dd><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step1"></a>LVM Kullanarak ev disk bölümünün ayarlanmasý</h3></div></dt><dd><p>Eðer sýradan bir disk bölümü kullanýyorsanýz güvenle bu bölümü atlayabilirsiniz.
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># pvcreate /dev/sda3
Physical volume "/dev/sda3" successfully created
# vgcreate vg_storage /dev/sda3
Volume group "vg_storage" successfully created
# vgchange -a y vg_storage
0 logical volume(s) in volume group "vg_storage" now active
# lvcreate -L20G -nlv_home vg_storage
Logical volume "lv_home" created</pre> </td></tr></table></div></p><p>LVM ile ilgili daha fazla detay için <a href="http://tldp.org/HOWTO/LVM-HOWTO/" target="_top">LVM NASIL</a> belgesine bakabilirsiniz.</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step2"></a>Ev dizininiz olacak disk bölümünün rasgele veriyle doldurulmasý</h3></div></dt><dd><p><div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># dd if=/dev/urandom of=/dev/vg_storage/lv_home
20481+0 records in
20480+0 records out
21474836480 bytes (21 GB) copied, 5554.23 s, 3.9 MB/s</pre> </td></tr></table></div></p><p>Bu iþlem takas alanýndan da çok zaman alacaðýndan öðle yemeðine ya da benzer bir iþe vakit ayýrabilirsiniz.</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step3"></a>Disk bölümünün sýfýrlanmasý ve baþlangýç anahtarýnýn atanmasý</h3></div></dt><dd><p>Unutmayýn; zayýf parola iþe yaramaz, parolanýzý unutursanýz oyun biter!<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># cryptsetup -c aes-cbc-essiv:sha256 -y -s 256 luksFormat /dev/vg_storage/lv_home
				
WARNING!
========
This will overwrite data on /dev/vg_storage/lv_home irrevocably.

Are you sure? (Type uppercase yes): YES
Enter LUKS passphrase: 
Verify passphrase: 
Command successful.</pre> </td></tr></table></div></p><p>Cipher olarak "aes-cbc-essi" kullanmamýzýn nedeni öntanýmlý olanýn <a href="http://en.wikipedia.org/wiki/Watermarking_attack" target="_top">Watermarking Saldýrýsýna</a> karþý savunmasýz oluþudur.</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step4"></a>Aygýt haritalamasýnýn yaratýlmasý</h3></div></dt><dd><p><div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># cryptsetup luksOpen /dev/vg_storage/lv_home cryptohome
Enter LUKS passphrase: 
key slot 0 unlocked.
Command successful.</pre> </td></tr></table></div></p><p>Aþaðýdaki komutla oluþturduðunuz aygýt haritasýný görebilirsiniz:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">$ ls -l /dev/mapper/
total 0
crw-rw---- 1 root root  10, 63 2008-05-04 18:46 control
brw-rw---- 1 root disk 254,  2 2008-05-04 20:53 cryptohome
brw-rw---- 1 root disk 254,  0 2008-05-04 18:52 cryptoswap
brw-rw---- 1 root disk 254,  1 2008-05-04 20:53 vg_storage-lv_home</pre> </td></tr></table></div></p><p>LVM'nin de device-mapper kullandýðýna dikkat edin (bu nedenle LVM hacimlari de listeleniyorlar).</p><p>Baþka bir yöntem olarak <b><tt>dmsetup ls</tt></b> komutunu kullanabilirsiniz:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">$ dmsetup ls
cryptoswap      (254, 0)
vg_storage-lv_home      (254, 1)
cryptohome      (254, 2)</pre> </td></tr></table></div></p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step5"></a>Dosya sistemi yaratýlmasý</h3></div></dt><dd><p>Artýk Þifrelenmiþ bir disk bölümümüz var, onu kullanmak için üzerinde bir dosya sistemi oluþturmalýyýz:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># mkfs.ext3 -j -m 1 -O dir_index,filetype,sparse_super /dev/mapper/cryptohome
mke2fs 1.40.8 (13-Mar-2008)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
1310720 inodes, 5242623 blocks
52426 blocks (1.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=0
160 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,
4096000

Writing inode tables: done
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done

This filesystem will be automatically checked every 28 mounts or
180 days, whichever comes first.  Use tune2fs -c or -i to override.</pre> </td></tr></table></div></p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step6"></a>Test</h3></div></dt><dd><p>Test için þifrelenmiþ disk bölümünü baðlamadan önce þifrelemeyi kapatýp yeniden açýyoruz:
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># cryptsetup luksClose cryptohome
# cryptsetup luksOpen /dev/vg_storage/lv_home cryptohome
Enter LUKS passphrase: 
key slot 0 unlocked.
Command successful.
# mkdir -p /mnt/cryptohome
# mount /dev/mapper/cryptohome /mnt/cryptohome
# touch /mnt/cryptohome/testfile
# ls /mnt/cryptohome/
testfile</pre> </td></tr></table></div></p><p>Çalýþýp çalýþmadýðýný aþaðýdaki komutla da öðrenebiliriz:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># cryptsetup status cryptohome
/dev/mapper/cryptohome is active:
cipher:  aes-cbc-essiv:sha256
keysize: 256 bits
device:  /dev/mapper/vg_storage-lv_home
offset:  2056 sectors
size:    41940984 sectors
mode:    read/write</pre> </td></tr></table></div></p><p>Her þey yolundaysa ev dizininizi yeni bölüme taþýyabilirsiniz.</p><p>Son olarak diski çözelim:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"> # umount /mnt/cryptohome
# cryptsetup luksClose cryptohome</pre> </td></tr></table></div></p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="encrypted-swap-howto-part2-step7"></a>Þifrelenmiþ ev dizininin baðlanma zamaný</h3></div></dt><dd><p>Bu aþamada bir karar vermeniz gerekiyor. Þifrelenmiþ disk bölümünüzün bilgisayarýnýz açýlýrken baðlanmasýný seçebilirsiniz, bu durumda açýlýþ iþlemleri LUKS parolasýný girmeniz için kesintiye uðrayacaktýr. Eðer bu bölümün oturum açtýðýnýzda otomatik olarak baðlanmasýný istiyorsanýz bir sonraki bölüme geçebilirsiniz.</p><p>Parolanýzý elle girmek yerine harici bir ortamda (örneðin bir usb diskte) saklamayý tercih edebilirsiniz. Bu konuda ayrýntýlý bilgi için <a href="http://wiki.archlinux.org/index.php/LUKS_Encrypted_Root#Storing_the_key_externally_.28USB_stick.29" target="_top">bu adrese</a> bakabilirsiniz.</p><p>Eðer tercihiniz diskin açýlýþta baðlanmasý ise <tt>/etc/crypttab</tt> dosyasýný aþaðýdaki gibi düzenleyin:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># cat /etc/crypttab
...
cryptohome /dev/vg_storage/lv_home none luks</pre> </td></tr></table></div></p><p><tt>/etc/fstab</tt> dosyasý da düzenlenmelidir:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen"># cat /etc/fstab
...
/dev/mapper/cryptohome	/mnt/cryptohome ext3 relatime,errors=remount-ro 0 2</pre> </td></tr></table></div></p><p>Artýk bilgisayarýnýzý yeniden baþlattýðýnýzda açýlýþ süreci siz LUKS parolanýzý girene kadar kesintiye uðrayacaktýr. Eðer doðru girerseniz ev dizininiz baðlanýr. Oturum açtýðýnýzda sizi bekleyen þifrelenmiþ bir ev dizini bulacaksýnýz.</p></dd></div></dl></dd></div></dl><h1></h1><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td width="40%" align="left"><a accesskey="p" href="../howto/encrypted-swap-howto-part1.html">Önceki</a> </td><td width="20%" align="center"><a accesskey="u" href="../howto/encrypted-swap-howto.html">Üst Ana Baþlýk</a></td><td width="40%" align="right"> <a accesskey="n" href="../howto/encrypted-swap-howto-part3.html">Sonraki</a></td></tr><tr><td width="40%" align="left" valign="top">Þifrelenmiþ Takas Alaný Kurulumu </td><td width="20%" align="center"><a accesskey="h" href="../KiTAPLIK/index.html">Baþlangýç</a></td><td width="40%" align="right" valign="top"> Oturum Açýlýrken Otomatik Baðlama</td></tr><tr><td colspan="3" align="center">
                  Bir <a href="http://www.belgeler.org/">Linux Kitaplýðý</a> Sayfasý
                </td></tr></table></td></tr></table></td></tr></table></body></html>
