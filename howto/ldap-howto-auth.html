<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-9"><meta name="date" content="2009-04-23T15:08:30+03:00"><title>Sistem Servislerinde Kimlik Kanýtlama</title><link rel="icon" type="image/png" href="../images/belgeler-logo.png"><link rel="stylesheet" href="../belgeler.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V-special(derived from 1.49 for Turkish Linux Documentation WG by Nilgün Belma Bugüner - nilgun@superonline.com)"><link rel="home" href="../KiTAPLIK/index.html" title="Linux Kitaplýðý"><link rel="up" href="../howto/ldap-howto.html" title="LDAP ile Kimlik Kanýtlama NASIL"><link rel="previous" href="../howto/ldap-howto-install.html" title="OpenLDAP Kurulumu ve Yapýlandýrmasý"><link rel="next" href="../howto/kerberos-howto.html" title="Kerberos Altyapýsý NASIL"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><th colspan="3" align="center">Sistem Servislerinde Kimlik Kanýtlama</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../howto/ldap-howto-install.html">Önceki</a> </td><th width="60%" align="center">LDAP ile Kimlik Kanýtlama NASIL</th><td width="20%" align="right"> <a accesskey="n" href="../howto/kerberos-howto.html">Sonraki</a></td></tr></table></td></tr></table></td></tr></table><dl><div class="sect1"><dt><div> <h2 class="title" style="clear: both"><a name="ldap-howto-auth"></a>Sistem Servislerinde Kimlik Kanýtlama</h2></div></dt><dd><p>LDAP, sistem servisleri için kimlik kanýtlamada <i>PAM</i> (Pluggable Authentication Modules) ile birlikte çalýþýr. Bu þekilde pam kullanan servislerin (ftp, ssh, sistem kullanýcýsý vb.) hepsi için tek bir yerden kimlik kanýtlama gerçekleþtirilir. Eðer servis kullanýcý adý ve parola dýþýnda baþka hesap bilgilerine de (örneðin ev dizini) ihtiyaç duyuyorsa NSS (Name Service Switch) kullanýlmalýdýr.  </p><dl><div class="sect2"><dt><div> <h3 class="title"><a name="ldap-pam-nss"></a>OpenLDAP + PAM + NSS</h3></div></dt><dd><p>Kurulum için <b><tt>apt-get install ldapscripts  libpam-ldap libnss-ldap</tt></b> komutu verilir. Burada ldapscripts paketi LDAP dizinindeki kullanýcý hesaplarýný yönetmek için (kullanýcý/grup ekleme, silme vb.) gereken kabuk betiklerini kurar. libpam-ldap paketi PAM kullanabilen servislerin LDAP üzerinden kimlik kanýtlama yapabilmesini saðlar. libnss-ldap paketi ise kimlik kanýtlama sýrasýnda gerekli olan diðer bilgilerin LDAP sunucudan alýnmasý için gereklidir. Kurulum sýrasýnda çeþitli diyaloglarla paketlerin yapýlandýrýlmasý yapýlýr.</p><p>Paketleri kurarken bizden bazý bilgileri istiyor. Libpam-ldap için ldap  host ismini, ldap'ýn base adresini (ldap.conf'deki kök dizini "dc=ornek,dc=com"), ldap versiyon 3 seçtik. Make local root Database admin (bu seçenekte bize root kullanýcý ile ldap admin gibi davransýn mý diye soruyor.) yes diyoruz. Does the LDAP database require login? (ldap veri tabaný için kullanýcý giriþi gereksin mi?) no diyoruz. LDAP account for root: ldap root kullancýsýnýn tam yolunu ( dn)  yazýyoruz. Ldap root'unun parolasýný yazýyoruz.Local crypt to use when changing passwords ( ldap kendi içerisindeki parolalarý nasýl saklasýn? ) md5 diyoruz. Ve þimdilik iþimiz bitti. Sonra <tt>/etc/nsswitch.conf</tt>'u düzenliyoruz. Bu dosyayý aþaðýdaki gibi deðiþtiriyoruz: 
		<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">passwd:         compat ldap
group:          compat ldap
shadow:         compat ldap</pre> </td></tr></table></div></p><p>Ardýndan <tt>/etc/libnns-ldap.conf</tt>'da ldap host'un
adresini, base adresini, ldap_version 3, binddn ve bindpw'yi deðiþtiriyoruz. Bind yaparken buradaki kullanýcý üzerinden yapar ya da rootdn rootpw girebilirsiniz.</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="ldap-howto-auth-egroupware"></a>Egroupware</h3></div></dt><dd><p>Egroupware programýnda yapacaðýmýz sadece kimlik kanýtlamasý kullanýcýlarýn diðer bilgilerini seçilen baþka bir veri tabanýnda kayýt edilecek þekilde hazýrlanmýþtýr bu ayarlar.</p><p>egroupware setup web sayfasýndan yönetici olarak giriþ yaptýktan sonra Configuration bölümünden Edit Current Configuration bölümüne geçiþ yapýyoruz.</p><p>Authentification / User Accounts: baþlýðýnýn altýnda bulunan Which kind of authentification do you want to use:  ldap - Kimlik kanýtlamasý için ne kullanýlacaðýný belirtiyoruz. Select where you want to store/retrieve user accounts: sql - Burada da kullanýcýnýn diðer bilgilerinin saklanacaðý yeri belirtiyoruz. Aþaðýda ise ldap ayarlarýnýn bulunduðu bölümde deðiþikler yapacaðýz.
		<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">Ýf using ldap:
LDAP host:              localhost (Ya da ldap sunucusun bulunduðunu ip adresi)
LDAP accounts context :  ou=dugum1,dc=comu,dc=edu,dc=tr
LDAP search filter accounts, default:       (uid=%user)
&#8220;uid=%user)&#8221;,%domain=eGW-domain:
LDAP group context:                     (bir group belirtmediðimiz için boþ)
LDAP rootdn(searching accounts and 
changing password):                     cd=manager,dc=comu,dc=edu,dc=tr
LDAP root password:                 xxx (slapd.conf içine girdiðimiz parola)
LDAP encryption:                    md5 
Do you want to manage homedirectory and loginshell attributes:           No(bu özelliðini sql üzerinde tutulacak.)
LDAP default homedirectory prefix (e.g. /home for /home/username):        /ldap/home
Ldap defualt shell(e.g. /bin/bash)      /bin/bash</pre> </td></tr></table></div></p><p>Böylece egroupware ile OpenLDAP iliþkilendirilmiþ oldu.</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="ldap-howto-auth-ftp"></a>Vsftp</h3></div></dt><dd><p>Vsftpd kimlik kanýtlamasýný pam üzerinden yapmaktadadýr. Bu yüzden pam'de deðiþiklikler yapýlacak. Ancak vsftpd de ufak birkaç deðiþiklik yapacaðýz. Baþlangýç olarak vsftpd yi yüklüyoruz.<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">#apt-get install vsftpd</pre> </td></tr></table></div></p><p><tt>/etc/vsftpd.conf</tt> dosyasýnda local_enable=YES satýrýný açýyoruz ki kayýtlý kullanýcýlar girebilsin. chroot_local_user=YES satýrýný açýyoruz. pam_service_name=vsftpd - bu satýrdan emin oluyoruz. Çünkü kimlik kanýtlamasý yaparken pam.d'nin altýndaki hangi dosyaya bakacaðýný belirtiyor.</p><p><tt>/etc/pam.d/vsftpd</tt> dosyasýna:
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">auth       sufficient   /lib/security/pam_ldap.so
account    sufficient   /lib/security/pam_ldap.so
password   sufficient   /lib/security/pam_ldap.so</pre> </td></tr></table></div> satýrlarýný ekliyoruz.</p><p><tt>/etc/pam_ldap.conf</tt> dosyasýnda:<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">host 127.0.0.1  // ldap sunucusunun adresi
base dc=comu,dc=edu,dc=tr
ldap_version 3
binddn cn=manager,dc=comu,dc=edu,dc=tr
bindpw xxx
scope sub // farklý düðümdeki kullanýcýlarda giriþ yapabilsin isterseniz bunu deðiþtirmeyebilirsiniz.
pam_login_attribute userid // giriþ yapacak kullanýcýn hangi özelligine göre seçileceði.
pam_password md5  // buradaki þifreleme þeklini önceden yapýlan ayarlar ile ayný olmalýdýr.</pre> </td></tr></table></div>
Bu ayarlardan sonra vsftpd, OpenLDAP ile kimlik kanýtlamasý yapacaktýr.</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="ldap-howto-auth-freeradius"></a>FreeRADIUS</h3></div></dt><dd><p>FreeRADIUS kimlik kanýtlamasýný farklý yöntemlerle yapabilmektedir. <tt>users</tt> dosyasýnda her kullanýcý için birer kullanýcý adý ve parola çifti saklanabileceði gibi istenirse bir veritabaný (mysql, postgresql, gibi) veya ldap kullanarak da kimlik kanýtlamasý yapýlabilir. Ldap kullanmak isterseniz <tt>freeradius-ldap*.deb</tt> paketini de (veya daðýtýmýnýza uygun paketi) kurmanýz gerekir.</p><dl><div class="sect3"><dt><div> <h4 class="title"><a name="ldap-howto-auth-freeradius-ldap"></a>OpenLDAP sunucusunda yapýlacaklar</h4></div></dt><dd><p>OpenLDAP sunucusunda FreeRADIUS için kullanabileceðiniz þema kullandýðýnýz pakete göre farklýlýk içermekle birlikte <tt>/usr/share/doc/freeradius/examples/openldap.schema</tt> dosyasýnda bulunmaktadýr. <tt>slapd.conf</tt> dosyasýnda ldap sunucunun bu þemayý kullanmasýný söylemeliyiz.</p><div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">...
include         /etc/ldap/schema/radius.schema
...</pre> </td></tr></table></div></dd></div></dl><dl><div class="sect3"><dt><div> <h4 class="title"><a name="ldap-howto-auth-freeradius-radius"></a>FreeRADIUS sunucusunda yapýlacaklar</h4></div></dt><dd><p>
			FreeRADIUS yapýlandýrma dosyalarýnda (<tt>radiusd.conf</tt>, <tt>sites-enabled/default</tt>, <tt>sites-enabled/inner-tunnel</tt>, <tt>ldap.attrmap</tt>) aþaðýdaki gibi gerekli deðiþiklikleri yapýyoruz.
		</p><p><tt>radiusd.conf</tt> dosyasýnda <i>ldap</i> bloðunu açarak parametreleri sunucumuza uygun bir þekilde giriyoruz:
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">ldap {
server = "localhost"
identity = "cn=admin,dc=localhost"
password = gizli
basedn = "dc=localhost"
base_filter = "(objectclass=radiusObjectProfile)"
access_attr = "cn"
dictionary_mapping = ${raddbdir}/ldap.attrmap
authtype = ldap
ldap_connections_number = 5
timeout = 4
timelimit = 3
net_timeout = 1
dictionary_mapping = ${confdir}/ldap.attrmap
password_attribute = userPassword
set_auth_type = no
}</pre> </td></tr></table></div>
		</p><p>
			<tt>sites-enabled/default</tt> dosyasýnda <i>authorize</i> bloðu içinde <i>ldap</i> satýrýný açýyoruz ve gereksiz olanlarý kapatýyoruz. <i>post-auth</i> bloðunda da <i>ldap</i> satýrýný açýyoruz:
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">authorize {
...
#		ntdomain
		ldap
#		unix
#		files
...
}
post-auth {
...
ldap
...
}</pre> </td></tr></table></div>
		</p><p>
			<tt>sites-enabled/inner-tunnel</tt> dosyasýnda aþaðýdaki þekilde deðiþiklik yapýyoruz:
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">...
#		chap
#		mschap
#		unix
#		ntdomain
ldap
}
post-auth {
...
ldap
...
}
post-proxy {
...
#		eap
...
}</pre> </td></tr></table></div>
		</p><p>
			<tt>ldap.attrmap</tt> dosyasýna aþaðýdaki satýrlarý ekliyoruz.
			<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">checkItem   User-Password                  userPassword
checkItem   Cleartext-Password             userPassword
replyItem   Tunnel-Type                    radiusTunnelType
replyItem   Tunnel-Medium-Type             radiusTunnelMediumType
replyItem   Tunnel-Private-Group-Id        radiusTunnelPrivateGroupId</pre> </td></tr></table></div>
		</p><p>Bu deðiþikliklerden sonra elbette freeradius süreci yeniden baþlatýlmalýdýr.</p></dd></div></dl></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="ldap-howto-auth-jabber"></a>Jabber</h3></div></dt><dd><p>Bu belge hazýrlanýrken jabber 2.2.1 sürümü kullanýlmýþtýr.</p><p>Jabber programýnda yapacaðýmýz yalnýzca kimlik kanýtlanmasýný yapýlacaktýr. Kullanýcýlarýn diðer bilgilerini seçilebilecek baþka bir veri tabanýnda ( mysql, postgresql, gibi) tutulacak þeklinde hazýrlanmýþtýr bu ayarlar.</p><p>Jabber kurulumunu kaynak koddan kurulmuþtur.</p><p>Jabber sunucusunu ldap ile kimlik kanýtlamak için configure sýrasýnda <b><tt>--enable-ldap  --enable-idn</tt></b> eklenmelidir. Jabber sunucusunun kurulum aþamasý bittikten sonra <tt>/usr/local/etc/</tt> altýnda gerekli olan ayar dosyalarýna gerekli deðiþiklikleri yapabiliriz.</p><p><tt>/usr/local/etc/c2s.xml</tt> dosyasýnda aþaðýdaki deðiþiklikler yapýlmalýdýr.</p><p><div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">&lt; authreg &gt; 
&lt; module &gt; ldap &lt;/ module &gt;
&lt;/ authreg &gt;
...
&lt; ldap&gt;
&lt; host &gt; ldap.comu.edu.tr &lt;/ host&gt;
&lt; v3 / &gt;
&lt; binddn &gt; cn=admin,dc=comu,dc=edu,dc=tr &lt;/ binddn&gt;
&lt; bindpw &gt; xxx &lt; / bindpw &gt;
&lt; uidattr &gt; uid &lt; / uidattr &gt; 
&lt; base &gt; dc=comu,dc=edu,dc=tr &lt; / base &gt;
&lt;/ ldap&gt;</pre> </td></tr></table></div></p><p>Bu deðiþiklikler sonrasýnda <b><tt>jabberd</tt></b> süreci yeniden baþlatýlmalýdýr.</p></dd></div></dl></dd></div></dl><h1></h1><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td width="40%" align="left"><a accesskey="p" href="../howto/ldap-howto-install.html">Önceki</a> </td><td width="20%" align="center"><a accesskey="u" href="../howto/ldap-howto.html">Üst Ana Baþlýk</a></td><td width="40%" align="right"> <a accesskey="n" href="../howto/kerberos-howto.html">Sonraki</a></td></tr><tr><td width="40%" align="left" valign="top">OpenLDAP Kurulumu ve Yapýlandýrmasý </td><td width="20%" align="center"><a accesskey="h" href="../KiTAPLIK/index.html">Baþlangýç</a></td><td width="40%" align="right" valign="top"> Kerberos Altyapýsý NASIL</td></tr><tr><td colspan="3" align="center">
                  Bir <a href="http://www.belgeler.org/">Linux Kitaplýðý</a> Sayfasý
                </td></tr></table></td></tr></table></td></tr></table></body></html>
