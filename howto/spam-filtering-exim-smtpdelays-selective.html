<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-9"><meta name="date" content="2006-04-25T01:56:21+03:00"><title>Seçimlik Gecikmeler</title><link rel="icon" type="image/png" href="../images/belgeler-logo.png"><link rel="stylesheet" href="../belgeler.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V-special(derived from 1.49 for Turkish Linux Documentation WG by Nilgün Belma Bugüner - nilgun@superonline.com)"><link rel="home" href="../KiTAPLIK/index.html" title="Linux Kitaplýðý"><link rel="up" href="../howto/spam-filtering-exim-smtpdelays.html" title="SMTP aktarým gecikmelerinin eklenmesi"><link rel="previous" href="../howto/spam-filtering-exim-smtpdelays-simple.html" title="Basit yöntem"><link rel="next" href="../howto/spam-filtering-exim-greylisting.html" title="Grilisteleme Desteðinin Eklenmesi"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><th colspan="3" align="center">Seçimlik Gecikmeler</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../howto/spam-filtering-exim-smtpdelays-simple.html">Önceki</a> </td><th width="60%" align="center">SMTP aktarým gecikmelerinin eklenmesi</th><td width="20%" align="right"> <a accesskey="n" href="../howto/spam-filtering-exim-greylisting.html">Sonraki</a></td></tr></table></td></tr></table></td></tr></table><dl><div class="sect2"><dt><div> <h3 class="title"><a name="spam-filtering-exim-smtpdelays-selective"></a>Seçimlik Gecikmeler</h3></div></dt><dd><p>
Benim gibi, SMTP aktarým gecikmelerine konu edeceðiniz konaklar için biraz daha seçici davranmak isteyebilirsiniz. Örneðin, bu belgede daha önce açýklandýðý gibi, DNS karalistelerinde bulunma durumunda ya da kesin bir redde konu olmayan ama doðrulama da yapýlamayan selamlaþmalar sonucunda bu gecikmeleri uygulamaya karar verebilirsiniz.
      </p><p>
Seçimlik gecikmelerin uygulayabilmek için <a href="../howto/spam-filtering-acl_rcpt_to_1.html" class="xref" title="acl_rcpt_to"> acl_rcpt_to</a> ACL'sindeki bazý sýnamalarý diðer ACL'lere taþýmak gerekir. Böylelikle, sorunlarýn iþaretlerini gördüðümüz anda gecikmeleri uygulayabilir ve kalleþ yazýlýmlarýn eþzamanlama hatalarý verme ve baþka sorunlarla karþýlaþma talihsizliðini arttýrmýþ oluruz.
      </p><p>
Özellikle yapacaklarýmýz:
      </p><p>
      <div class="itemizedlist"><ul type="disc"><li>
DNS sýnamalarýný <a href="../howto/spam-filtering-acl_connect_final.html" class="xref" title="acl_connect"> acl_connect</a> ACL'sine taþýyacaðýz.
        <p></p><p></p></li><li>
Selamlaþma sýnamalarýný <a href="../howto/spam-filtering-acl_helo_final.html" class="xref" title="acl_helo"> acl_helo</a> ACL'sine taþýyacaðýz. Bir istisna: Bu noktada henüz selamlaþmanýn olmayýþýný sýnayamayýz, çünkü bu ACL bir EHLO veya HELO komutunun varlýðý halinde devreye girer. Bu sýnamayý <a href="../howto/spam-filtering-acl_mail_from_final.html" class="xref" title="acl_mail_from"> acl_mail_from</a> ACL'sinde yapacaðýz.
        <p></p><p></p></li><li>
Gönderici adresi sýnamalarýný <a href="../howto/spam-filtering-acl_mail_from_final.html" class="xref" title="acl_mail_from"> acl_mail_from</a> ACL'sine taþýyacaðýz.
        <p></p><p></p></li></ul></div>
      </p><p>
Bununla birlikte, evvelce açýkladýðýmýz sebeplerle, asýl reddi <b><tt>RCPT TO:</tt></b> komutunu alana dek yapmayacaðýz. Bunu gerçekleþtirmek için önceki ACL'lerdeki <tt>deny</tt> deyimlerini <tt>warn</tt> deyimlerine dönüþtüreceðiz ve <b><tt>RCPT TO:</tt></b> komutunu alana kadar hata iletilerini ve uyarýlarý saklamak için Exim'in genel amaçlý ACL deðiþkenlerini kullanacaðýz. Þöyle ki:
      </p><p>
      <div class="itemizedlist"><ul type="disc"><li>
Teslimatý reddetmeye karar verirsek, gönderilecek <b><tt>550</tt></b> yanýtlarýnda kullanmak üzere hata iletisini saklamak için <tt>$acl_c0</tt> veya <tt>$acl_m0</tt> deðiþkenini kullanacaðýz:
          <p></p><p>
          <div class="itemizedlist"><ul type="round"><li>
Eðer gerekli koþullar bir posta teslimatýndan önce saðlanmýþsa (örn, <a href="../howto/spam-filtering-acl_connect_final.html" class="xref" title="acl_connect"> acl_connect</a> veya <a href="../howto/spam-filtering-acl_helo_final.html" class="xref" title="acl_helo"> acl_helo</a> ACL'sinde), baðlantý boyunca deðer saklayabilen <tt>$acl_c0</tt> deðiþkenini kullanacaðýz.
            <p></p><p></p></li><li>
Posta aktarýmý baþladýktan sonra (örn. <b><tt>MAIL FROM:</tt></b> komutundan sonra), <tt>$acl_c0</tt> içeriðini iletilere özel deðiþken olan <tt>$acl_m0</tt>'a kopyalayacaðýz ve bu noktadan sonra bu deðiþkeni kullanacaðýz. Böylece, bu ileti ile belirlenmiþ bir durum, ayný baðlantýdan alýnan daha sonraki iletilerden etkilenmemiþ olacak.
            <p></p><p></p></li></ul></div>
          </p><p>
Ayrýca, benzer þekilde, <i>günlükleme iletilerini</i> <tt>$acl_c1</tt> veya <tt>$acl_m1</tt> deðiþkeninde saklayacaðýz.
        </p><p></p></li><li>
Eðer, kesin reddine karar verilecek yeterli koþullarýn saðlanmadýðý bir durumla karþýlaþýrsak, <tt>$acl_c1</tt> veya <tt>$acl_m1</tt> deðiþkeninde sadece bir uyarý iletisi saklayacaðýz. Posta aktarýmý baþladýðýnda (örn, <a href="../howto/spam-filtering-acl_mail_from_final.html" class="xref" title="acl_mail_from"> acl_mail_from</a> ACL'sinde), bu deðiþkenin içeriðini ileti baþlýðýna da ekleyeceðiz.
        <p></p><p></p></li><li>
Daha sonraki sýnamalarýn (SpamAssassin taramasý gibi) sonuçlarýna bakmaksýzýn bir iletiyi <i>kabul etmeye</i> karar verirsek, durum belirtecini <tt>$acl_c0</tt> veya <tt>$acl_m0</tt> deðiþkeninde saklayacak ama <tt>$acl_c1</tt> ve <tt>$acl_m1</tt> deðiþkenlerini boþ býrakacaðýz.
        <p></p><p></p></li><li>
Her ACL'nin baþlangýcýnda ve <a href="../howto/spam-filtering-acl_mail_from_final.html" class="xref" title="acl_mail_from"> acl_mail_from</a> ACL'sinde, o anki zaman damgasýný <tt>$acl_m2</tt> deðiþkenine atayacaðýz. ACL'nin sonunda ise, <tt>$acl_c1</tt> veya <tt>$acl_m1</tt> deðiþkeninin varlýðýna bakýp zaman damgasýndaki deðerden baþlayarak 20 saniyelik gecikmeyi dolduracak þekilde SMTP aktarým gecikmesini uygulayacaðýz.
        <p></p><p></p></li></ul></div>
      </p><p>
Kullandýðýmýz deðiþkenleri bir tablo halinde özetlersek:
      </p><p>
      <div class="table"><p><a name="spam-filtering-aclvarusage"></a><b>Tablo 4A..1. ACL baðlantý/ileti deðiþkenlerinin kullanýmý</b></p><table cellspacing="1" cellpadding="3" summary="ACL baðlantý/ileti deðiþkenlerinin kullanýmý" border="1"><colgroup><col><col></colgroup><thead><tr><th align="left">Deðiþkenler:</th><th align="left"><tt>$acl_[cm]0</tt> boþ</th><th align="left"><tt>$acl_[cm]0</tt> dolu</th></tr></thead><tbody><tr><td align="left"><tt>$acl_[cm]1</tt> boþ</td><td align="left">(Henüz bir karar yok)</td><td align="left">Postayý kabul ediyoruz</td></tr><tr><td align="left"><tt>$acl_[cm]1</tt> dolu</td><td align="left">Baþlýða bir uyarý ekliyoruz</td><td align="left">Postayý reddediyoruz</td></tr></tbody></table></div>
      </p><p>
Bu yaklaþýma bir örnek olarak, selamlaþma ile ilgili iki sýnama yapacaðýz; birinde karþý taraf kendini IP adresi ile tanýtýrsa postayý reddedeceðiz, diðerinde ise doðrulanabilir olmayan bir isim belirtirse bir uyarýyý kayda alacaðýz. Önceden, bu iki sýnamayý <a href="../howto/spam-filtering-acl_rcpt_to_1.html" class="xref" title="acl_rcpt_to"> acl_rcpt_to</a> ACL'sinde yapmýþtýk, þimdi <a href="../howto/spam-filtering-acl_helo_final.html" class="xref" title="acl_helo"> acl_helo</a> ACL'sine alacaðýz.
      </p><p>
<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">
acl_helo:
  # Gecikme uygularken baþlangýç olarak kullanmak üzere o anki zaman
  # bilgisini kaydediyoruz.
  warn
    set acl_m2  = $tod_epoch

  # Posta yerel SMTP üzerinden alýnmýþsa (yani, TCP/IP baðlantýsý
  # ile gelmiyorsa), kabul ediyoruz. Bunu boþ bir konak alanýný
  # sýnayarak yapacaðýz. Ayrýca, postalarýný rölelediðimiz
  # konaklardan gelen postalarý da kabul edeceðiz.
  #
  accept
    hosts       = : +relay_from_hosts

  # Karþý taraf selamlaþmayý IP adresi ile yaparsa, $acl_c0'a red
  # iletisini, $acl_c1'e ise günlük iletisini kaydedeceðiz. Bunlarý
  # daha sonra "deny" deyiminde kullanacaðýz. Bu deðiþkenlerin varlýðý
  # göndericinin oyalanacaðýný belirtecek.
  #
  warn
    condition   = ${if isip {$sender_helo_name}{true}{false}}
    set acl_c0  = Message was delivered by ratware
    set acl_c1  = remote host used IP address in HELO/EHLO greeting

  # Selamlaþmada doðrulamasý baþarýsýz olursa, acl_c1'e bir uyarý iletisi
  # kaydedeceðiz. Bu iletiyi daha sonra ileti baþlýðýna ekleyeceðiz.
  # Bu deðiþkenin varlýðý göndericinin oyalanacaðýný belirtecek.
  #
  warn
    condition   = ${if !def:acl_c1 {true}{false}}
    !verify     = helo
    set acl_c1  = X-HELO-Warning: Remote host $sender_host_address \
                  ${if def:sender_host_name {($sender_host_name) }}\
                  incorrectly presented itself as $sender_helo_name
    log_message = remote host presented unverifiable HELO/EHLO greeting.

  #
  # ... bu örnek için diðer sýnamalarý atlýyoruz ...
  #

  # Baðlantýyý kabul ediyoruz ama $acl_c1'de bir ileti varsa, göndericiyi
  # 20 saniye oyalýyoruz.
  accept
    set acl_m2  = ${if def:acl_c1 {${eval:20 + $acl_m2 - $tod_epoch}}{0}}
    delay       = ${if &gt;{$acl_m2}{0}{$acl_m2}{0}}s

</pre> </td></tr></table></div>
      </p><p>
Sonra, <a href="../howto/spam-filtering-acl_mail_from_final.html" class="xref" title="acl_mail_from"> acl_mail_from</a> ACL'sinde iletileri <tt>$acl_c{0,1}</tt>'den <tt>$acl_m{0,1}</tt> deðiþkenlerine aktaracaðýz. Ayrýca, <tt>$acl_c1</tt> içeriðini ileti baþlýðýna ekleyeceðiz.
      </p><p>
<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">
acl_mail_from:
  # Gecikme uygularken baþlangýç olarak kullanmak üzere o anki zaman
  # bilgisini kaydediyoruz.
  warn
    set acl_m2  = $tod_epoch

  # Posta yerel SMTP üzerinden alýnmýþsa (yani, TCP/IP baðlantýsý
  # ile gelmiyorsa), kabul ediyoruz. Bunu boþ bir konak alanýný
  # sýnayarak yapacaðýz. Ayrýca, postalarýný rölelediðimiz
  # konaklardan gelen postalarý da kabul edeceðiz.
  #
  accept
    hosts     = : +relay_from_hosts

  # $acl_c0 ve $acl_c1 deðiþkenleri bu SMTP aktarýmý sýrasýnda yapýlmaya
  # çalýþýlacak her teslimat için kullanýlacak red ve/veya uyarý iletilerini
  # içeriyor olacak (böyle bir durum varsa). Bu deðiþkenlerin içeriklerini
  # $acl_m{0,1} iletiye özel deðiþkenlere aktaracaðýz ve $acl_m1'deki uyarýyý
  # ileti baþlýðýna ekleyeceðiz. (Bir red durumunda, $acl_m1 artýk bir günlük
  # kaydý içeriyor olacak, ama iletiyi bununla deðil baþlýðýndaki kayýtla
  # reddedeceðiz.)
  #
  warn
    set acl_m0  = $acl_c0
    set acl_m1  = $acl_c1
    message     = $acl_c1


  #
  # ... bu örnek için diðer sýnamalarý atlýyoruz ...
  #

  # Baðlantýyý kabul ediyoruz ama $acl_c1'de bir ileti varsa, göndericiyi
  # 20 saniye oyalýyoruz.
  accept
    set acl_m2  = ${if def:acl_c1 {${eval:20 + $acl_m2 - $tod_epoch}}{0}}
    delay       = ${if &gt;{$acl_m2}{0}{$acl_m2}{0}}s

</pre> </td></tr></table></div>
      </p><p>
Kalan deðiþiklikler için <a href="../howto/spam-filtering-exim-final.html" class="xref" title="Tamamlanmýþ ACL'ler"> Tamamlanmýþ ACL'ler</a> bölümüne bakýnýz.
      </p></dd></div></dl><h1></h1><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td width="40%" align="left"><a accesskey="p" href="../howto/spam-filtering-exim-smtpdelays-simple.html">Önceki</a> </td><td width="20%" align="center"><a accesskey="u" href="../howto/spam-filtering-exim-smtpdelays.html">Üst Ana Baþlýk</a></td><td width="40%" align="right"> <a accesskey="n" href="../howto/spam-filtering-exim-greylisting.html">Sonraki</a></td></tr><tr><td width="40%" align="left" valign="top">Basit yöntem </td><td width="20%" align="center"><a accesskey="h" href="../KiTAPLIK/index.html">Baþlangýç</a></td><td width="40%" align="right" valign="top"> Grilisteleme Desteðinin Eklenmesi</td></tr><tr><td colspan="3" align="center">
                  Bir <a href="http://www.belgeler.org/">Linux Kitaplýðý</a> Sayfasý
                </td></tr></table></td></tr></table></td></tr></table></body></html>
