<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-9"><meta name="date" content="2006-04-25T01:55:49+03:00"><title>RTLinux Programlarý Yazmak</title><link rel="icon" type="image/png" href="../images/belgeler-logo.png"><link rel="stylesheet" href="../belgeler.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V-special(derived from 1.49 for Turkish Linux Documentation WG by Nilgün Belma Bugüner - nilgun@superonline.com)"><link rel="home" href="../KiTAPLIK/index.html" title="Linux Kitaplýðý"><link rel="up" href="../howto/rtlinux-howto.html" title="RTLinux NASIL"><link rel="previous" href="../howto/rtlinux-howto-whyrtlinux.html" title="Neden RTLinux"><link rel="next" href="../howto/rtlinux-howto-compile.html" title="Derleme ve Çalýþtýrma"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><th colspan="3" align="center">RTLinux Programlarý Yazmak</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="../howto/rtlinux-howto-whyrtlinux.html">Önceki</a> </td><th width="60%" align="center">RTLinux NASIL</th><td width="20%" align="right"> <a accesskey="n" href="../howto/rtlinux-howto-compile.html">Sonraki</a></td></tr></table></td></tr></table></td></tr></table><dl><div class="sect1"><dt><div> <h2 class="title" style="clear: both"><a name="rtlinux-howto-rtlinuxprogramming"></a>RTLinux Programlarý Yazmak</h2></div></dt><dd><dl><div class="sect2"><dt><div> <h3 class="title"><a name="rtlinux-howto-writingmodulles"></a>Modül Yazýmýna Giriþ</h3></div></dt><dd><p>Modül nedir, dersek? Bir Linux modülü <b><tt>gcc</tt></b>'nin <tt>-c</tt> seçeneði ile kullanýlmasý sonucu oluþan nesne dosyasýndan baþka birþey deðildir. Bir modül, sýradan bir C dili dosyasýnýn <tt>main()</tt> iþlevi olmaksýzýn derlenmesiyle oluþur. <tt>main()</tt> iþlevi yerine <tt>init_module/cleanup_module</tt> iþlev çifti vardýr:
</p><p>
<div class="itemizedlist"><ul type="disc"><li><tt>init_module()</tt> iþlevi, modül çekirdeðe eklenirken çaðrýlýr. Bu iþlev baþarý halinde 0, baþarýsýzlýk halinde negatif deðer döndürmelidir.
</li><li><tt>cleanup_module()</tt> iþlevi, tam modül kaldýrýlýrken çaðrýlýr.
</li></ul></div>
</p><p>
Genellikle, <tt>init_module()</tt> ya çekirdekle bir þeyler için bir eylemcinin varlýðýný bildirir ya da bir çekirdek iþlevini kendi kodu ile deðiþtirir (genellikle kod bir þeyler yaptýktan sonra orjinal iþlevi çaðýrýr). <tt>cleanup_module()</tt> iþlevinin <tt>init_module()</tt> iþlevinin yaptýðýný geri aldýðý kabul edilir, böylece modül emniyetle kaldýrýlabilir.
</p><p>
Örneðin, eðer siz <tt>module.c</tt> diye bir C dosyasý yazarsanýz (<tt>main()</tt> iþlevi <tt>init_module()</tt> ve <tt>cleanup_module()</tt> iþlevleriyle deðiþtirilerek), bu kod,
</p><p>
<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">$ <b><tt>gcc -c {BAZI-SEÇENEKLER} my_module.c</tt></b></pre> </td></tr></table></div>
</p><p>
ile bir modüle dönüþtürülebilir. Bu komut;
</p><p>
<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">$ <b><tt>insmod module.o</tt></b></pre> </td></tr></table></div>
</p><p>
gibi bir '<b><tt>insmod</tt></b>' komutuyla çekirdeðe eklenebilen <tt>module.o</tt> isimli bir modül dosyasý oluþturur. Benzer biçimde, bu modülü kaldýrmak için '<b><tt>rmmod</tt></b>' komutunu kullanabilirsiniz:
</p><p>
<div class="screen" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="screen">$ <b><tt>rmmod module</tt></b></pre> </td></tr></table></div>
</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="rtlinux-howto-creatingthreads"></a>RTLinux Evrelerinin Oluþturulmasý</h3></div></dt><dd><p>
Bir gerçek zamanlý uygulama genellikle çeþitli evrelerin çalýþmalarýnýn birleþimidir. Evreler bir ortak adres uzayýný paylaþan hafif süreçlerdir. RTLinux'da, bütün evreler Linux çekirdeðinin adres uzayýný paylaþýr. Evrelerin kullanmanýn avantajý, evreler arasýndaki geçiþin baðlamsal geçiþlere göre oldukça ucuz olmasýdýr. Aþaðýdaki örnekte görüleceði gibi farklý iþlevler kullanarak bir evrenin çalýþmasý üzerinde tam bir denetim kurabiliriz.
</p></dd></div></dl><dl><div class="sect2"><dt><div> <h3 class="title"><a name="rtlinux-howto-exampleprogramme"></a>Örnek Bir Program</h3></div></dt><dd><p>
Bir evrenin çalýþmasýný anlamanýn en iyi yolu, bir gerçek zamanlý programý izlemektir. Örneðin, aþaðýda görünen program her saniye bir kez çalýþacak ve her bir yineleme sýrasýnda 'Merhaba Dunya' yazacak.
</p><div class="example"><p><b>Örnek 3.1. hello.c dosyasý</b></p><div class="programlisting" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="programlisting">
#include &lt;rtl.h&gt;
#include &lt;time.h&gt;
#include &lt;pthread.h&gt;

pthread_t evre;

void * evre_kodu(void)
{
        pthread_make_periodic_np(pthread_self(), gethrtime(), 1000000000);

        while (1)
        {
                pthread_wait_np ();
                rtl_printf("Merhaba Dunya\n");
        }

        return 0;
}

int init_module(void)
{
   return pthread_create(&amp;evre, NULL, evre_kodu, NULL);
}

void cleanup_module(void)
{
   pthread_delete_np(evre);
}
</pre> </td></tr></table></div></div><p>
Þöyle <tt>init_module()</tt> ile baþlayalým. <tt>init_module()</tt>, <b><tt>pthread_create()</tt></b> iþlevini çaðýrýr. Bu, çaðrýlan evre ile ayný anda çalýþan yeni bir evre oluþturmak içindir. <i>Bu iþlev sadece Linux çekirdek evresinden çaðrýlabilir (<tt>init_module()</tt> kullanýlarak)</i>.
</p><p>
<div class="programlisting" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="programlisting">
int  pthread_create(pthread_t      *evre,
                    pthread_attr_t *attr,
                    void           * (*thread_code)(void *),
                    void           *arg);
</pre> </td></tr></table></div>
</p><p>
Oluþturulan yeni evre <tt>pthread.h</tt> baþlýk dosyasýnda tanýmlanan <b><tt>pthread_t</tt></b> türündedir. Bu evre, <tt>evre_kodu()</tt> iþlevini argümanýný <i><tt>arg</tt></i> ile aktararak çalýþtýrýr. <i><tt>attr</tt></i> deðiþkeni yeni evreye uygulanacak evre özniteliklerini belirler. Eðer <i><tt>attr</tt></i> NULL ise, öntanýmlý öznitelikler kullanýlýr.
</p><p>
Bundan dolayý burada, <tt>evre_kodu()</tt> argümansýz çaðrýlýr. <tt>evre_kodu</tt> üç bileþenden (ilklendirme, çalýþma ve sonlandýrma) oluþur.
</p><p>
Ýlkllendirme aþamasýnda <tt>pthread_make_periodic_np()</tt> çaðrýsý yapýlýr.
</p><p>
<div class="programlisting" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="programlisting">
int pthread_make_periodic_np(pthread_t evre,
                             hrtime_t  baþlatma_aný,
                             hrtime_t  süre);
</pre> </td></tr></table></div>
</p><p>
<tt>pthread_make_periodic_np</tt> <i><tt>evre</tt></i>'yi çalýþmaya hazýr olarak imler. Evre <i><tt>baþlatma_aný</tt></i>'nda çalýþmasýna baþlayacak ve nanosaniyelerle belirlenmiþ  <i><tt>süre</tt></i>'yle çalýþacaktýr.
</p><p>
<tt>gethrtime</tt> iþlevi sistemin baþlamasýndan beri geçen zamaný nanosaniyeler cinsinden döndürür.
</p><p>
<div class="programlisting" align="right"><table width="95%" cellpadding="5" cellspacing="1" border="0" class="preoutline"><tr class="preinline"><td> <pre class="programlisting">
hrtime_t gethrtime(void);
</pre> </td></tr></table></div>
</p><p>
Bu zaman asla sýfýrlanamaz ya da ayarlanamaz. <tt>gethrtime</tt>, daima monoton artan deðerler verir. <b><tt>hrtime_t</tt></b> türü, 64 bitlik iþaretli tamsayý belirtir.
</p><p>
<tt>pthread_make_periodic_np()</tt> çaðrýsýyla evre, iþlemci zamanlayýcýsýna bu evreyi bir saniyede bir çalýþtýrmasýný söyler. Bu, evre için ilklendirme bölümünün sonudur.
</p><p>
<tt>while()</tt> döngüsü, çalýþmakta olan gerçek zamanlý evreyi sonraki <i><tt>süre</tt></i>'nin baþlamasýna kadar beklemeye alacak <tt>pthread_wait_np()</tt> iþlevine bir çaðrý ile baþlar. Bu evre önceki bir <tt>pthread_make_periodic_np</tt> çaðrýsýný ile devreye alýnýr. Evre tekrar çaðrýlýr çaðrýlmaz, baþka bir <tt>pthread_wait_np()</tt> çaðrýsýyla karþýlaþana kadar <tt>while</tt> döngüsünde kalanlar çalýþtýrýlýr.
</p><p>
Bizim döngüden çýkmamýzý saðlayacak bir yol olmadýðýndan bu evre 1Hz'lik sýklýkla çalýþtýrýlmaya devam edecektir. Programý sonlandýrmanýn tek yolu <b><tt>rmmod</tt></b> komutu ile onu çekirdekten çýkarmaktýr. Bu, evreye ayrýlan özkaynaklarý serbest býrakarak evreyi iptal eden <tt>pthread_delete_np()</tt> iþlevini çaðýran <tt>cleanup_module()</tt> iþlevini çaðýracaktýr.
</p></dd></div></dl></dd></div></dl><h1></h1><table width="100%" summary="Navigation header" cellpadding="1" cellspacing="0" border="0"><tr><td bgcolor="black" class="navoutline"><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td bgcolor="white" class="navinline"><table width="100%" cellpadding="3" cellspacing="0" border="0"><tr><td width="40%" align="left"><a accesskey="p" href="../howto/rtlinux-howto-whyrtlinux.html">Önceki</a> </td><td width="20%" align="center"><a accesskey="u" href="../howto/rtlinux-howto.html">Üst Ana Baþlýk</a></td><td width="40%" align="right"> <a accesskey="n" href="../howto/rtlinux-howto-compile.html">Sonraki</a></td></tr><tr><td width="40%" align="left" valign="top">Neden RTLinux </td><td width="20%" align="center"><a accesskey="h" href="../KiTAPLIK/index.html">Baþlangýç</a></td><td width="40%" align="right" valign="top"> Derleme ve Çalýþtýrma</td></tr><tr><td colspan="3" align="center">
                  Bir <a href="http://www.belgeler.org/">Linux Kitaplýðý</a> Sayfasý
                </td></tr></table></td></tr></table></td></tr></table></body></html>
